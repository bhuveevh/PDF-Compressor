<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PDF Compressor - VacancyHai.Online</title>
  <style>
    body {
      background: #f0f0f3;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px;
    }
    .container {
      background: #fff;
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
      border-radius: 20px;
      padding: 30px;
      width: 400px;
      max-width: 90%;
      text-align: center;
    }
    h2 {
      margin-bottom: 20px;
      font-weight: 600;
    }
    input[type="file"], input[type="number"] {
      margin: 10px 0;
      padding: 10px;
      width: 100%;
      border-radius: 10px;
      border: 1px solid #ccc;
    }
    button {
      padding: 12px 20px;
      border: none;
      background: linear-gradient(to right, #007aff, #00c6ff);
      color: white;
      font-weight: 600;
      border-radius: 12px;
      margin: 10px;
      cursor: pointer;
      transition: 0.3s;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    #outputSize {
      margin-top: 15px;
      font-size: 14px;
      color: #444;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>PDF Compressor</h2>
    <input type="file" id="pdfInput" accept="application/pdf">
    <input type="number" id="targetSize" placeholder="Target size in KB">
    <button id="compressBtn" disabled>Compress PDF</button>
    <button id="downloadBtn" disabled>Download PDF</button>
    <div id="outputSize"></div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
  <script>
    const pdfInput = document.getElementById('pdfInput');
    const targetSizeInput = document.getElementById('targetSize');
    const compressBtn = document.getElementById('compressBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const outputSize = document.getElementById('outputSize');

    let compressedPdfBytes = null;

    pdfInput.addEventListener('change', () => {
      compressBtn.disabled = !pdfInput.files.length;
      outputSize.textContent = '';
    });

    compressBtn.addEventListener('click', async () => {
      const file = pdfInput.files[0];
      if (!file) return;

      const arrayBuffer = await file.arrayBuffer();
      const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);

      // remove metadata for slight size reduction
      pdfDoc.setTitle("");
      pdfDoc.setAuthor("");
      pdfDoc.setSubject("");
      pdfDoc.setKeywords([]);
      pdfDoc.setProducer("");
      pdfDoc.setCreator("");
      pdfDoc.setCreationDate(null);
      pdfDoc.setModificationDate(null);

      // serialize PDF
      const compressedBytes = await pdfDoc.save({ useObjectStreams: true });
      compressedPdfBytes = compressedBytes;

      const finalSizeKB = (compressedBytes.byteLength / 1024).toFixed(2);
      outputSize.textContent = `Compressed Size: ${finalSizeKB} KB`;

      downloadBtn.disabled = false;
    });

    downloadBtn.addEventListener('click', () => {
      if (!compressedPdfBytes) return;
      const blob = new Blob([compressedPdfBytes], { type: 'application/pdf' });
      const link = document.createElement('a');
      const seconds = Math.floor(Date.now() / 1000);
      link.download = `VACANCYHAIONLINE${seconds}.pdf`;
      link.href = URL.createObjectURL(blob);
      link.click();
    });
  </script>
</body>
</html>
